<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   width="1400"
   height="800"
   viewBox="0 0 1400 800"
   version="1.1"
   xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .main-title { font-family: Arial, sans-serif; font-size: 22px; font-weight: bold; fill: #2c3e50; }
      .section-title { font-family: Arial, sans-serif; font-size: 16px; font-weight: bold; fill: #34495e; }
      .subsection-title { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; fill: #7f8c8d; }
      .tech-text { font-family: Arial, sans-serif; font-size: 10px; fill: #2c3e50; }
      .code-text { font-family: monospace; font-size: 9px; fill: #27ae60; }
      .signal-flow { stroke: #3498db; stroke-width: 3; fill: none; marker-end: url(#bluearrow); }
      .data-flow { stroke: #e74c3c; stroke-width: 2; fill: none; marker-end: url(#redarrow); }
      .process-flow { stroke: #f39c12; stroke-width: 2; fill: none; marker-end: url(#orangearrow); }
      .hardware-box { fill: #3498db; stroke: #2980b9; stroke-width: 2; opacity: 0.8; }
      .software-box { fill: #2ecc71; stroke: #27ae60; stroke-width: 2; opacity: 0.8; }
      .data-box { fill: #f1c40f; stroke: #f4d03f; stroke-width: 2; opacity: 0.8; }
      .output-box { fill: #9b59b6; stroke: #8e44ad; stroke-width: 2; opacity: 0.8; }
      .rf-signal { fill: #e74c3c; stroke: #c0392b; stroke-width: 2; opacity: 0.9; }
    </style>
    <marker id="bluearrow" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0,0 10,3.5 0,7 " fill="#3498db" />
    </marker>
    <marker id="redarrow" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0,0 10,3.5 0,7 " fill="#e74c3c" />
    </marker>
    <marker id="orangearrow" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0,7 0,0 10,3.5 " fill="#f39c12" />
    </marker>
  </defs>

  <!-- RF Signal Source -->
  <rect x="50" y="48" width="150" height="80" class="rf-signal" rx="8" />
  <text x="125" y="73" text-anchor="middle" class="section-title" fill="white">DAB+ Transmitter</text>
  <text x="60" y="93" class="tech-text" fill="white">Thailand 6C</text>
  <text x="60" y="108" class="tech-text" fill="white">185.360 MHz</text>
  <text x="60" y="123" class="tech-text" fill="white">10kW ERP</text>

  <!-- Antenna -->
  <circle cx="250" cy="88" r="25" class="hardware-box" />
  <text x="250" y="93" text-anchor="middle" class="tech-text" fill="white">Antenna</text>
  <path d="M 200,88 H 320" class="signal-flow" />

  <!-- RTL-SDR Hardware -->
  <rect x="320" y="48" width="180" height="80" class="hardware-box" rx="8" />
  <text x="410" y="68" text-anchor="middle" class="section-title" fill="white">RTL-SDR Blog V4</text>
  <text x="330" y="88" class="tech-text" fill="white">R828D Tuner</text>
  <text x="330" y="103" class="tech-text" fill="white">RTL2832U ADC</text>
  <text x="330" y="118" class="tech-text" fill="white">1PPM TCXO</text>
  <text x="430" y="88" class="tech-text" fill="white">2.048 MSPS</text>
  <text x="430" y="103" class="tech-text" fill="white">8-bit I/Q</text>
  <text x="430" y="118" class="tech-text" fill="white">USB 2.0</text>

  <!-- Phase 1: I/Q Data Acquisition -->
  <rect x="50" y="178" width="300" height="120" class="software-box" rx="8" />
  <text x="200" y="198" text-anchor="middle" class="section-title" fill="white">Phase 1: I/Q Data Acquisition</text>

  <!-- lab3_1a.py -->
  <rect x="70" y="218" width="120" height="70" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="130" y="233" text-anchor="middle" class="code-text">lab3_1a.py</text>
  <text x="75" y="248" class="tech-text">pyrtlsdr.RtlSdr()</text>
  <text x="75" y="263" class="tech-text">set_freq(185360000)</text>
  <text x="75" y="278" class="tech-text">read_samples()</text>

  <!-- lab3_1b.py -->
  <rect x="210" y="218" width="120" height="70" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="270" y="233" text-anchor="middle" class="code-text">lab3_1b.py</text>
  <text x="215" y="248" class="tech-text">socket.connect()</text>
  <text x="215" y="263" class="tech-text">rtl_tcp protocol</text>
  <text x="215" y="278" class="tech-text">network I/Q stream</text>

  <!-- Phase 1 Data Output -->
  <rect x="380" y="178" width="140" height="120" class="data-box" rx="8" />
  <text x="450" y="198" text-anchor="middle" class="section-title">I/Q Data Files</text>
  <text x="390" y="218" class="tech-text">Format: Complex64</text>
  <text x="390" y="233" class="tech-text">Rate: 2.048 MHz</text>
  <text x="390" y="248" class="tech-text">Size: ~16 MB/sec</text>
  <text x="390" y="263" class="code-text">raw_iq_data.bin</text>
  <text x="390" y="278" class="code-text">network_iq_data.bin</text>

  <!-- Phase 2: ETI Processing (eti-cmdline) -->
  <rect x="50" y="338" width="470" height="160" class="software-box" rx="8" />
  <text x="285" y="358" text-anchor="middle" class="section-title" fill="white">Phase 2: ETI Stream Generation (eti-cmdline)</text>

  <!-- eti-cmdline tool -->
  <rect x="70" y="378" width="130" height="100" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="135" y="393" text-anchor="middle" class="subsection-title">eti-cmdline</text>
  <text x="75" y="408" class="tech-text">RTL-SDR → ETI</text>
  <text x="75" y="423" class="tech-text">OFDM demod</text>
  <text x="75" y="438" class="tech-text">FIC/MSC decode</text>
  <text x="75" y="453" class="tech-text">Channel 6C</text>
  <text x="75" y="468" class="tech-text">-J (JSON export)</text>

  <!-- Processing Details -->
  <rect x="220" y="378" width="110" height="100" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="275" y="393" text-anchor="middle" class="subsection-title">OFDM/FIC</text>
  <text x="225" y="408" class="tech-text">FFT 2048</text>
  <text x="225" y="423" class="tech-text">1536 carriers</text>
  <text x="225" y="438" class="tech-text">QPSK demod</text>
  <text x="225" y="453" class="tech-text">Viterbi decode</text>
  <text x="225" y="468" class="tech-text">Service info</text>

  <!-- ETI Format -->
  <rect x="350" y="378" width="150" height="100" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="425" y="393" text-anchor="middle" class="subsection-title">ETI Output</text>
  <text x="355" y="408" class="tech-text">Frame: 6144 bytes</text>
  <text x="355" y="423" class="tech-text">Duration: 24 ms</text>
  <text x="355" y="438" class="tech-text">Bitrate: 2.048 Mbps</text>
  <text x="355" y="453" class="tech-text">ETI-NI format</text>
  <text x="355" y="468" class="tech-text">+ JSON metadata</text>

  <!-- ETI Stream Output -->
  <rect x="560" y="338" width="160" height="160" class="data-box" rx="8" />
  <text x="640" y="358" text-anchor="middle" class="section-title">ETI Stream</text>
  <text x="570" y="378" class="code-text">dab_ensemble.eti</text>
  <text x="570" y="393" class="code-text">ensemble-ch-6C.json</text>
  <text x="570" y="413" class="tech-text">ETSI EN 300 799</text>
  <text x="570" y="428" class="tech-text">~1052 frames</text>
  <text x="570" y="443" class="tech-text">~25 seconds</text>
  <text x="570" y="458" class="tech-text">Station list:</text>
  <text x="570" y="473" class="tech-text">18 services found</text>

  <!-- Phase 3: ETI Analysis -->
  <rect x="50" y="538" width="320" height="140" class="software-box" rx="8" />
  <text x="210" y="558" text-anchor="middle" class="section-title" fill="white">Phase 3: Service Discovery (JSON-based)</text>

  <rect x="70" y="578" width="140" height="80" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="140" y="593" text-anchor="middle" class="code-text">lab3_3.py</text>
  <text x="75" y="608" class="tech-text">Load ensemble JSON</text>
  <text x="75" y="623" class="tech-text">Parse station list</text>
  <text x="75" y="638" class="tech-text">Build service_list.json</text>
  <text x="75" y="653" class="tech-text">Build subchannel_info</text>

  <rect x="230" y="578" width="120" height="80" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="290" y="593" text-anchor="middle" class="subsection-title">Service Data</text>
  <text x="235" y="608" class="tech-text">Station names</text>
  <text x="235" y="623" class="tech-text">Service IDs</text>
  <text x="235" y="638" class="tech-text">Components</text>
  <text x="235" y="653" class="tech-text">Subchannels</text>

  <!-- Service Metadata -->
  <rect x="400" y="538" width="160" height="140" class="data-box" rx="8" />
  <text x="480" y="558" text-anchor="middle" class="section-title">Service Metadata</text>
  <text x="410" y="578" class="code-text">service_list.json</text>
  <text x="410" y="593" class="code-text">subchannel_info.json</text>
  <text x="410" y="613" class="tech-text">18 Services:</text>
  <text x="410" y="628" class="tech-text">• BOONMA TV</text>
  <text x="410" y="643" class="tech-text">• JKP TEST04-18</text>
  <text x="410" y="658" class="tech-text">• KKN MAHA NAKHON</text>

  <!-- Phase 4: Audio and Data Services -->
  <rect x="750" y="178" width="400" height="230" class="software-box" rx="8" />
  <text x="950" y="198" text-anchor="middle" class="section-title" fill="white">Phase 4: Audio Extraction and Playback (ni2out)</text>

  <!-- ni2out tool -->
  <rect x="770" y="218" width="110" height="80" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="825" y="233" text-anchor="middle" class="subsection-title">ni2out</text>
  <text x="775" y="248" class="tech-text">ETI → AAC</text>
  <text x="775" y="263" class="tech-text">Service select</text>
  <text x="775" y="278" class="tech-text">Audio extract</text>
  <text x="775" y="293" class="tech-text">HE-AAC stream</text>

  <!-- AAC Decoder -->
  <rect x="900" y="218" width="110" height="80" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="955" y="233" text-anchor="middle" class="subsection-title">ffmpeg</text>
  <text x="905" y="248" class="tech-text">AAC decode</text>
  <text x="905" y="263" class="tech-text">PCM WAV</text>
  <text x="905" y="278" class="tech-text">48kHz stereo</text>
  <text x="905" y="293" class="tech-text">16-bit PCM</text>

  <!-- Audio Output -->
  <rect x="1030" y="218" width="110" height="80" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="1085" y="233" text-anchor="middle" class="subsection-title">PyAudio</text>
  <text x="1035" y="248" class="tech-text">PCM playback</text>
  <text x="1035" y="263" class="tech-text">ALSA backend</text>
  <text x="1035" y="278" class="tech-text">3.5mm jack</text>
  <text x="1035" y="293" class="tech-text">Volume control</text>

  <!-- MOT/DLS Processing -->
  <rect x="770" y="318" width="110" height="70" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="825" y="333" text-anchor="middle" class="subsection-title">DLS (Mock)</text>
  <text x="775" y="348" class="tech-text">Dynamic labels</text>
  <text x="775" y="363" class="tech-text">Now playing</text>
  <text x="775" y="378" class="tech-text">Station info</text>

  <rect x="900" y="318" width="110" height="70" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="955" y="333" text-anchor="middle" class="subsection-title">MOT (Mock)</text>
  <text x="905" y="348" class="tech-text">Demo images</text>
  <text x="905" y="363" class="tech-text">ni2out: no MOT</text>
  <text x="905" y="378" class="tech-text">Use dablin_gtk</text>

  <rect x="1030" y="318" width="110" height="70" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="1085" y="333" text-anchor="middle" class="subsection-title">Storage</text>
  <text x="1035" y="348" class="tech-text">extracted_audio/</text>
  <text x="1035" y="363" class="tech-text">slideshow_images/</text>
  <text x="1035" y="378" class="tech-text">*.aac, *.wav</text>

  <!-- Phase 4 Output -->
  <rect x="1190" y="178" width="170" height="230" class="output-box" rx="8" />
  <text x="1275" y="198" text-anchor="middle" class="section-title" fill="white">Media Output</text>
  <text x="1200" y="223" class="code-text" fill="white">service_0xA001*.aac</text>
  <text x="1200" y="238" class="code-text" fill="white">service_0xA001*_pcm.wav</text>
  <text x="1200" y="253" class="code-text" fill="white">slideshow_images/*.png</text>
  <text x="1200" y="273" class="tech-text" fill="white">Real-time audio</text>
  <text x="1200" y="288" class="tech-text" fill="white">~178 KB AAC</text>
  <text x="1200" y="303" class="tech-text" fill="white">~4.8 MB PCM</text>
  <text x="1200" y="318" class="tech-text" fill="white">~10 seconds</text>
  <text x="1200" y="338" class="tech-text" fill="white">Mock slideshow</text>
  <text x="1200" y="353" class="tech-text" fill="white">320×240 PNG</text>
  <text x="1200" y="368" class="tech-text" fill="white">Demo images</text>

  <!-- Phase 5: GUI Application -->
  <rect x="750" y="458" width="610" height="180" class="software-box" rx="8" />
  <text x="1055" y="478" text-anchor="middle" class="section-title" fill="white">Phase 5: Complete GUI Application (PyQt5 + Touchscreen)</text>

  <!-- GUI Components -->
  <rect x="770" y="498" width="110" height="70" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="825" y="513" text-anchor="middle" class="subsection-title">Station List</text>
  <text x="775" y="528" class="tech-text">QListWidget</text>
  <text x="775" y="543" class="tech-text">18 services</text>
  <text x="775" y="558" class="tech-text">Touch selection</text>

  <rect x="900" y="498" width="110" height="70" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="955" y="513" text-anchor="middle" class="subsection-title">Audio Player</text>
  <text x="905" y="528" class="tech-text">DABServicePlayer</text>
  <text x="905" y="543" class="tech-text">Play/Stop</text>
  <text x="905" y="558" class="tech-text">Volume slider</text>

  <rect x="1030" y="498" width="110" height="70" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="1085" y="513" text-anchor="middle" class="subsection-title">Spectrum</text>
  <text x="1035" y="528" class="tech-text">pyqtgraph</text>
  <text x="1035" y="543" class="tech-text">FFT waterfall</text>
  <text x="1035" y="558" class="tech-text">Signal quality</text>

  <rect x="1160" y="498" width="110" height="70" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="1215" y="513" text-anchor="middle" class="subsection-title">Slideshow</text>
  <text x="1165" y="528" class="tech-text">QLabel display</text>
  <text x="1165" y="543" class="tech-text">Mock images</text>
  <text x="1165" y="558" class="tech-text">Auto advance</text>

  <!-- Additional GUI Components -->
  <rect x="770" y="578" width="110" height="40" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="825" y="598" text-anchor="middle" class="tech-text">Settings Panel</text>
  <text x="775" y="613" class="tech-text">RTL-SDR config</text>

  <rect x="900" y="578" width="110" height="40" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="955" y="598" text-anchor="middle" class="tech-text">Now Playing</text>
  <text x="905" y="613" class="tech-text">Dynamic display</text>

  <rect x="1030" y="578" width="110" height="40" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="1085" y="598" text-anchor="middle" class="tech-text">Signal Quality</text>
  <text x="1035" y="613" class="tech-text">SNR/BER meters</text>

  <rect x="1160" y="578" width="110" height="40" fill="#ffffff" stroke="#27ae60" stroke-width="1" rx="4" />
  <text x="1215" y="598" text-anchor="middle" class="tech-text">Touch Events</text>
  <text x="1165" y="613" class="tech-text">7" touchscreen</text>

  <!-- Signal Flow Arrows -->
  <path d="m 410,128 v 20 H 200 v 30" class="signal-flow" />
  <path d="m 350,238 h 30" class="data-flow" />
  <path d="m 450,298 v 20 H 285 v 20" class="data-flow" />
  <path d="m 520,418 h 40" class="data-flow" />
  <path d="m 640,498 v 20 H 210 v 20" class="data-flow" />
  <path d="m 370,608 h 30" class="data-flow" />
  <path d="M 640,338 V 158 h 310 v 60" class="process-flow" />
  <path d="M 560,608 H 730 V 288 h 40" class="process-flow" />
  <path d="m 1150,298 h 40" class="data-flow" />
  <path d="m 950,408 v 50" class="process-flow" />

  <!-- Tool Summary -->
  <rect x="50" y="708" width="1310" height="70" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="3" />
  <text x="60" y="728" class="subsection-title">Key External Tools and Paths</text>
  <text x="60" y="743" class="tech-text">• eti-cmdline: /home/pi/DAB_Plus_Labs/eti/eti-cmdline (from eti-stuff, RTL-SDR to ETI conversion)</text>
  <text x="60" y="758" class="tech-text">• ni2out: /home/pi/DAB_Plus_Labs/eti/ni2out (from eti-tools, ETI to AAC audio extraction, NO MOT support)</text>
  <text x="60" y="773" class="tech-text">• Real MOT extraction: dablin_gtk (GUI viewer) or XPADxpert (Java GUI tool) - See LAB3.md for details</text>
</svg>
